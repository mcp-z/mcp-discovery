<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@mcp-z/mcp-discovery</title><meta name="description" content="Documentation for @mcp-z/mcp-discovery"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">@mcp-z/mcp-discovery</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@mcp-z/mcp-discovery</h1></div><div class="tsd-panel tsd-typography"><h1 id="mcp-zmcp-discovery" class="tsd-anchor-link">@mcp-z/mcp-discovery<a href="#mcp-zmcp-discovery" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><a href="https://www.npmjs.com/package/@mcp-z/mcp-discovery"><img src="https://img.shields.io/npm/v/@mcp-z/mcp-discovery.svg" alt="npm"></a>
<a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></p>
<p><strong>Zero-configuration service discovery for MCP servers via mDNS. Supports HTTP and WebSocket transports.</strong></p>
<hr>
<h2 id="why-this-exists" class="tsd-anchor-link">Why This Exists<a href="#why-this-exists" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When running a cluster of MCP servers, you often need both public and private interfaces:</p>
<ul>
<li><strong>Public interface</strong> (<code>/mcp</code>) - External access, secured via OAuth/authentication</li>
<li><strong>Private interface</strong> (<code>/internal/mcp</code>) - Internal cluster communication, discovered via mDNS</li>
</ul>
<p>This library enables zero-configuration discovery of private MCP endpoints within your local network, optionally secured with PSK (pre-shared key) authentication.</p>
<p><strong>Use Cases:</strong></p>
<ul>
<li>MCP server clusters that need to discover each other</li>
<li>Internal service mesh communication</li>
<li>Development/staging environments</li>
<li>Local network deployments where manual configuration is impractical</li>
</ul>
<p>‚ö†Ô∏è <strong>Security Notice:</strong> This library is designed for <strong>trusted local networks</strong> (same LAN/VLAN). Do not expose discovery or PSK-authenticated endpoints to untrusted networks. If you're unsure about securing your MCP servers or what's appropriate for your situation, <strong>consult a security expert</strong>.</p>
<hr>
<h2 id="features" class="tsd-anchor-link">Features<a href="#features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>üîç <strong>Service Discovery</strong> - Find MCP servers on your local network via mDNS/DNS-SD</li>
<li>üì¢ <strong>Service Advertisement</strong> - Broadcast your MCP server's availability</li>
<li>üåê <strong>HTTP &amp; WebSocket</strong> - Support for both transport types</li>
<li>üîí <strong>Optional PSK Authentication</strong> - Pre-shared key helpers for secure communication</li>
<li>üì¶ <strong>Version Selection</strong> - Filter services by version compatibility</li>
<li>üîå <strong>MCP SDK Integration</strong> - Works seamlessly with official <code>@modelcontextprotocol/sdk</code></li>
<li>üìò <strong>TypeScript</strong> - Full type definitions included</li>
<li>üéØ <strong>Zero Configuration</strong> - Works out-of-the-box on macOS, Linux (Avahi), Windows (Bonjour)</li>
</ul>
<hr>
<h2 id="install" class="tsd-anchor-link">Install<a href="#install" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@mcp-z/mcp-discovery</span>
</code><button type="button">Copy</button></pre>

<hr>
<h2 id="quick-start" class="tsd-anchor-link">Quick Start<a href="#quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="server-advertise-your-service" class="tsd-anchor-link">Server: Advertise Your Service<a href="#server-advertise-your-service" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">advertiseService</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mcp-z/mcp-discovery&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">stopAdvertising</span><span class="hl-1"> = </span><span class="hl-0">advertiseService</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">cluster:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-cluster&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">serviceName:</span><span class="hl-1"> </span><span class="hl-2">&#39;gmail&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">transport:</span><span class="hl-1"> </span><span class="hl-2">&#39;http&#39;</span><span class="hl-1">,  </span><span class="hl-7">// or &#39;ws&#39;</span><br/><span class="hl-1">  </span><span class="hl-4">port:</span><span class="hl-1"> </span><span class="hl-8">8080</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">path:</span><span class="hl-1"> </span><span class="hl-2">&#39;/internal/mcp&#39;</span><span class="hl-1">,  </span><span class="hl-7">// Use /internal/mcp for private cluster communication</span><br/><span class="hl-1">  </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-2">&#39;1.0.0&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">node:</span><span class="hl-1"> </span><span class="hl-2">&#39;http:prod&#39;</span><span class="hl-1">,  </span><span class="hl-7">// Unique identifier for this server instance</span><br/><span class="hl-1">  </span><span class="hl-4">auth:</span><span class="hl-1"> </span><span class="hl-2">&#39;psk&#39;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// Stop advertising when shutting down</span><br/><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;SIGINT&#39;</span><span class="hl-1">, () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">stopAdvertising</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-0">exit</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="client-discover-and-connect" class="tsd-anchor-link">Client: Discover and Connect<a href="#client-discover-and-connect" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">discoverServices</span><span class="hl-1">, </span><span class="hl-4">toBaseUrl</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mcp-z/mcp-discovery&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Client</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@modelcontextprotocol/sdk/client/index.js&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">StreamableHTTPClientTransport</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@modelcontextprotocol/sdk/client/streamableHttp.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// 1. Discover services</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">services</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">discoverServices</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">cluster:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-cluster&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">serviceName:</span><span class="hl-1"> </span><span class="hl-2">&#39;gmail&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">timeoutMs:</span><span class="hl-1"> </span><span class="hl-8">1500</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// 2. Select service (e.g., highest version)</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">service</span><span class="hl-1"> = </span><span class="hl-4">services</span><br/><span class="hl-1">  .</span><span class="hl-0">sort</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> (</span><span class="hl-4">b</span><span class="hl-1">.</span><span class="hl-4">version</span><span class="hl-1"> || </span><span class="hl-2">&#39;0&#39;</span><span class="hl-1">).</span><span class="hl-0">localeCompare</span><span class="hl-1">(</span><span class="hl-4">a</span><span class="hl-1">.</span><span class="hl-4">version</span><span class="hl-1"> || </span><span class="hl-2">&#39;0&#39;</span><span class="hl-1">, </span><span class="hl-5">undefined</span><span class="hl-1">, { </span><span class="hl-4">numeric:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> }))</span><br/><span class="hl-1">  [</span><span class="hl-8">0</span><span class="hl-1">];</span><br/><br/><span class="hl-7">// 3. Connect with MCP SDK</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">url</span><span class="hl-1"> = </span><span class="hl-0">toBaseUrl</span><span class="hl-1">(</span><span class="hl-4">service</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">transport</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">StreamableHTTPClientTransport</span><span class="hl-1">(</span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">URL</span><span class="hl-1">(</span><span class="hl-4">url</span><span class="hl-1">));</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">client</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Client</span><span class="hl-1">({ </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-app&#39;</span><span class="hl-1">, </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-2">&#39;1.0.0&#39;</span><span class="hl-1"> }, { </span><span class="hl-4">capabilities:</span><span class="hl-1"> {} });</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">(</span><span class="hl-4">transport</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// 4. Use the client</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">tools</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">listTools</span><span class="hl-1">();</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Available tools:&#39;</span><span class="hl-1">, </span><span class="hl-4">tools</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<hr>
<h2 id="api-reference" class="tsd-anchor-link">API Reference<a href="#api-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="advertiseserviceopts" class="tsd-anchor-link"><code>advertiseService(opts)</code><a href="#advertiseserviceopts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Broadcast your MCP service on the local network.</p>
<p><strong>Options:</strong></p>
<ul>
<li><code>cluster</code> (string) - Cluster name (e.g., 'production', 'dev')</li>
<li><code>serviceName</code> (string) - Service identifier (e.g., 'gmail', 'sheets')</li>
<li><code>transport</code> ('http' | 'ws') - Transport protocol</li>
<li><code>port</code> (number) - Port number</li>
<li><code>path</code> (string, optional) - URL path (default: '/mcp')</li>
<li><code>version</code> (string, optional) - Service version (default: '1.0.0')</li>
<li><code>node</code> (string) - Unique node identifier (e.g., 'http:prod-01')</li>
<li><code>auth</code> ('psk' | 'mtls', optional) - Authentication type (default: 'psk')</li>
</ul>
<p><strong>Returns:</strong> Function to stop advertising</p>
<h3 id="discoverservicesopts" class="tsd-anchor-link"><code>discoverServices(opts)</code><a href="#discoverservicesopts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Find MCP services on the local network.</p>
<p><strong>Options:</strong></p>
<ul>
<li><code>cluster</code> (string) - Cluster to search in</li>
<li><code>serviceName</code> (string) - Service to find</li>
<li><code>timeoutMs</code> (number, optional) - Discovery timeout (default: 1500ms)</li>
</ul>
<p><strong>Returns:</strong> <code>Promise&lt;ServiceInfo[]&gt;</code></p>
<p><strong>ServiceInfo:</strong></p>
<pre><code class="typescript"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">cluster</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">serviceName</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">transport</span><span class="hl-1">: </span><span class="hl-2">&#39;http&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;ws&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">host</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">port</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">path</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">version</span><span class="hl-1">?: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">node</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">auth</span><span class="hl-1">: </span><span class="hl-2">&#39;psk&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;mtls&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="tobaseurlservice" class="tsd-anchor-link"><code>toBaseUrl(service)</code><a href="#tobaseurlservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Convert a discovered service to a connection URL.</p>
<pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">url</span><span class="hl-1"> = </span><span class="hl-0">toBaseUrl</span><span class="hl-1">(</span><span class="hl-4">service</span><span class="hl-1">);</span><br/><span class="hl-7">// &#39;http://hostname.local:8080/mcp&#39; or &#39;ws://hostname.local:8080/mcp&#39;</span>
</code><button type="button">Copy</button></pre>

<hr>
<h2 id="transport-support" class="tsd-anchor-link">Transport Support<a href="#transport-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="http" class="tsd-anchor-link">HTTP<a href="#http" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Use with official SDK's <code>StreamableHTTPClientTransport</code>:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">StreamableHTTPClientTransport</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@modelcontextprotocol/sdk/client/streamableHttp.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">transport</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">StreamableHTTPClientTransport</span><span class="hl-1">(</span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">URL</span><span class="hl-1">(</span><span class="hl-0">toBaseUrl</span><span class="hl-1">(</span><span class="hl-4">service</span><span class="hl-1">)));</span>
</code><button type="button">Copy</button></pre>

<h3 id="websocket" class="tsd-anchor-link">WebSocket<a href="#websocket" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Client:</strong> Use SDK's <code>WebSocketClientTransport</code> (SDK 1.18+)</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">WebSocketClientTransport</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@modelcontextprotocol/sdk/client/websocket.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">transport</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">WebSocketClientTransport</span><span class="hl-1">(</span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">URL</span><span class="hl-1">(</span><span class="hl-0">toBaseUrl</span><span class="hl-1">(</span><span class="hl-4">service</span><span class="hl-1">)));</span>
</code><button type="button">Copy</button></pre>

<p><strong>Server:</strong> Use included <code>WebSocketServerTransport</code></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">WebSocketServerTransport</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mcp-z/mcp-discovery/transports/websocket-server.js&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Server</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@modelcontextprotocol/sdk/server/index.js&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">WebSocketServer</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;ws&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">wss</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">WebSocketServer</span><span class="hl-1">({ </span><span class="hl-4">port:</span><span class="hl-1"> </span><span class="hl-8">8080</span><span class="hl-1"> });</span><br/><span class="hl-4">wss</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;connection&#39;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">ws</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">transport</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">WebSocketServerTransport</span><span class="hl-1">(</span><span class="hl-4">ws</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">server</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Server</span><span class="hl-1">({ </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-server&#39;</span><span class="hl-1">, </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-2">&#39;1.0.0&#39;</span><span class="hl-1"> }, { </span><span class="hl-4">capabilities:</span><span class="hl-1"> {} });</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">(</span><span class="hl-4">transport</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<hr>
<h2 id="service-selection" class="tsd-anchor-link">Service Selection<a href="#service-selection" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="filter-by-transport" class="tsd-anchor-link">Filter by Transport<a href="#filter-by-transport" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">httpServices</span><span class="hl-1"> = </span><span class="hl-4">services</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">transport</span><span class="hl-1"> === </span><span class="hl-2">&#39;http&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">wsServices</span><span class="hl-1"> = </span><span class="hl-4">services</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">transport</span><span class="hl-1"> === </span><span class="hl-2">&#39;ws&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h3 id="select-by-version" class="tsd-anchor-link">Select by Version<a href="#select-by-version" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-7">// Highest version</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">latest</span><span class="hl-1"> = </span><span class="hl-4">services</span><br/><span class="hl-1">  .</span><span class="hl-0">sort</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> (</span><span class="hl-4">b</span><span class="hl-1">.</span><span class="hl-4">version</span><span class="hl-1"> || </span><span class="hl-2">&#39;0&#39;</span><span class="hl-1">).</span><span class="hl-0">localeCompare</span><span class="hl-1">(</span><span class="hl-4">a</span><span class="hl-1">.</span><span class="hl-4">version</span><span class="hl-1"> || </span><span class="hl-2">&#39;0&#39;</span><span class="hl-1">, </span><span class="hl-5">undefined</span><span class="hl-1">, { </span><span class="hl-4">numeric:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> }))</span><br/><span class="hl-1">  [</span><span class="hl-8">0</span><span class="hl-1">];</span><br/><br/><span class="hl-7">// Semantic version range (using semver package)</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">semver</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;semver&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">compatible</span><span class="hl-1"> = </span><span class="hl-4">services</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">version</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">semver</span><span class="hl-1">.</span><span class="hl-0">satisfies</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">version</span><span class="hl-1">, </span><span class="hl-2">&#39;^1.0.0&#39;</span><span class="hl-1">));</span>
</code><button type="button">Copy</button></pre>

<h3 id="multiple-criteria" class="tsd-anchor-link">Multiple Criteria<a href="#multiple-criteria" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">best</span><span class="hl-1"> = </span><span class="hl-4">services</span><br/><span class="hl-1">  .</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">transport</span><span class="hl-1"> === </span><span class="hl-2">&#39;ws&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-4">s</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">s</span><span class="hl-1">.</span><span class="hl-4">version</span><span class="hl-1">?.</span><span class="hl-0">startsWith</span><span class="hl-1">(</span><span class="hl-2">&#39;2.&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">  .</span><span class="hl-0">sort</span><span class="hl-1">((</span><span class="hl-4">a</span><span class="hl-1">, </span><span class="hl-4">b</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> (</span><span class="hl-4">b</span><span class="hl-1">.</span><span class="hl-4">version</span><span class="hl-1"> || </span><span class="hl-2">&#39;0&#39;</span><span class="hl-1">).</span><span class="hl-0">localeCompare</span><span class="hl-1">(</span><span class="hl-4">a</span><span class="hl-1">.</span><span class="hl-4">version</span><span class="hl-1"> || </span><span class="hl-2">&#39;0&#39;</span><span class="hl-1">, </span><span class="hl-5">undefined</span><span class="hl-1">, { </span><span class="hl-4">numeric:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> }))</span><br/><span class="hl-1">  [</span><span class="hl-8">0</span><span class="hl-1">];</span>
</code><button type="button">Copy</button></pre>

<hr>
<h2 id="authentication" class="tsd-anchor-link">Authentication<a href="#authentication" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="psk-pre-shared-key" class="tsd-anchor-link">PSK (Pre-Shared Key)<a href="#psk-pre-shared-key" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Optional HMAC-based authentication helpers for inter-server communication on trusted networks.</p>
<p>‚ö†Ô∏è <strong>Security Warning:</strong> PSK authentication is suitable for internal cluster communication on trusted local networks. It is <strong>NOT</strong> a replacement for proper authentication (OAuth, mTLS) on public endpoints. Use at your own risk. If unsure, consult a security expert.</p>
<p><strong>Recommended Pattern:</strong></p>
<ul>
<li><strong>Public endpoint</strong> (<code>/mcp</code>) - Use OAuth, API keys, or other robust authentication</li>
<li><strong>Internal endpoint</strong> (<code>/internal/mcp</code>) - Use PSK + discovery for cluster communication</li>
</ul>
<p><strong>Build auth header (client):</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">buildAuthHeader</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mcp-z/mcp-discovery&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">authHeader</span><span class="hl-1"> = </span><span class="hl-0">buildAuthHeader</span><span class="hl-1">(</span><span class="hl-4">secret</span><span class="hl-1">, </span><span class="hl-2">&#39;POST&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;/mcp&#39;</span><span class="hl-1">, </span><span class="hl-4">requestBody</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Verify auth (server):</strong></p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">verifyPskHmac</span><span class="hl-1">, </span><span class="hl-4">expressPskHmac</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@mcp-z/mcp-discovery&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Express middleware</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-0">expressPskHmac</span><span class="hl-1">(</span><span class="hl-4">secret</span><span class="hl-1">));</span><br/><br/><span class="hl-7">// Manual verification</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">valid</span><span class="hl-1"> = </span><span class="hl-0">verifyPskHmac</span><span class="hl-1">({ </span><span class="hl-4">secret</span><span class="hl-1">, </span><span class="hl-4">method</span><span class="hl-1">, </span><span class="hl-4">path</span><span class="hl-1">, </span><span class="hl-4">body</span><span class="hl-1">, </span><span class="hl-4">authHeader</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<p>See <a href="media/psk-auth.test.ts"><code>test/psk-auth.test.ts</code></a> and <a href="media/psk.ts"><code>src/psk.ts</code></a> for complete examples.</p>
<hr>
<h2 id="understanding-servicename-node-and-version" class="tsd-anchor-link">Understanding serviceName, node, and version<a href="#understanding-servicename-node-and-version" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong><code>serviceName</code></strong> - What the service does (e.g., 'gmail'). Same across all instances.</li>
<li><strong><code>node</code></strong> - Which server instance (e.g., 'http:prod-01'). Must be unique per instance.</li>
<li><strong><code>version</code></strong> - Which API version (e.g., '2.0.0'). Used for client filtering.</li>
</ul>
<p><strong>Why all three?</strong> <code>serviceName</code> + <code>node</code> form the unique mDNS name. <code>version</code> is metadata for compatibility filtering.</p>
<p><strong>Example:</strong> Running two servers of the same service:</p>
<pre><code class="typescript"><span class="hl-7">// Server 1</span><br/><span class="hl-0">advertiseService</span><span class="hl-1">({ </span><span class="hl-4">serviceName:</span><span class="hl-1"> </span><span class="hl-2">&#39;gmail&#39;</span><span class="hl-1">, </span><span class="hl-4">node:</span><span class="hl-1"> </span><span class="hl-2">&#39;http:prod-01&#39;</span><span class="hl-1">, </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-2">&#39;2.0.0&#39;</span><span class="hl-1">, </span><span class="hl-4">port:</span><span class="hl-1"> </span><span class="hl-8">8080</span><span class="hl-1"> });</span><br/><br/><span class="hl-7">// Server 2 (load balancing)</span><br/><span class="hl-0">advertiseService</span><span class="hl-1">({ </span><span class="hl-4">serviceName:</span><span class="hl-1"> </span><span class="hl-2">&#39;gmail&#39;</span><span class="hl-1">, </span><span class="hl-4">node:</span><span class="hl-1"> </span><span class="hl-2">&#39;http:prod-02&#39;</span><span class="hl-1">, </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-2">&#39;2.0.0&#39;</span><span class="hl-1">, </span><span class="hl-4">port:</span><span class="hl-1"> </span><span class="hl-8">8081</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<p>Clients discover both and can select either.</p>
<hr>
<h2 id="examples--tests" class="tsd-anchor-link">Examples &amp; Tests<a href="#examples--tests" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>See <a href="media/test"><code>test/</code></a> directory for comprehensive examples:</p>
<ul>
<li><a href="media/websocket-integration.test.ts"><code>websocket-integration.test.ts</code></a> - Full WebSocket server + discovery + connection</li>
<li><a href="media/version-selection.test.ts"><code>version-selection.test.ts</code></a> - Version filtering strategies</li>
<li><a href="media/psk-auth.test.ts"><code>psk-auth.test.ts</code></a> - PSK authentication</li>
</ul>
<p>Run tests: <code>npm test</code> (17 tests, all passing)</p>
<hr>
<h2 id="how-it-works" class="tsd-anchor-link">How It Works<a href="#how-it-works" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This library uses mDNS (Multicast DNS) / Bonjour for zero-configuration service discovery on local networks.</p>
<p><strong>Platform Support:</strong></p>
<ul>
<li><strong>macOS:</strong> Built-in Bonjour support</li>
<li><strong>Linux:</strong> Requires Avahi daemon (<code>apt install avahi-daemon</code>)</li>
<li><strong>Windows:</strong> Requires Bonjour for Windows</li>
</ul>
<hr>
<h2 id="contributing" class="tsd-anchor-link">Contributing<a href="#contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>See <a href="media/CONTRIBUTING.md">CONTRIBUTING.md</a> for development guidelines.</p>
<hr>
<h2 id="resources" class="tsd-anchor-link">Resources<a href="#resources" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="https://modelcontextprotocol.io/">Model Context Protocol</a> - Official MCP documentation</li>
<li><a href="https://github.com/modelcontextprotocol/typescript-sdk">MCP TypeScript SDK</a> - Official SDK</li>
<li><a href="https://github.com/mcp-z/mcp-discovery/issues">Report Issues</a> - Bug reports and feature requests</li>
</ul>
<hr>
<h2 id="license" class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>MIT ¬© <a href="https://github.com/kmalakoff">Kevin Malakoff</a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#mcp-zmcp-discovery"><span>@mcp-<wbr/>z/mcp-<wbr/>discovery</span></a><ul><li><a href="#why-this-exists"><span>Why <wbr/>This <wbr/>Exists</span></a></li><li><a href="#features"><span>Features</span></a></li><li><a href="#install"><span>Install</span></a></li><li><a href="#quick-start"><span>Quick <wbr/>Start</span></a></li><li><ul><li><a href="#server-advertise-your-service"><span>Server: <wbr/>Advertise <wbr/>Your <wbr/>Service</span></a></li><li><a href="#client-discover-and-connect"><span>Client: <wbr/>Discover and <wbr/>Connect</span></a></li></ul></li><li><a href="#api-reference"><span>API <wbr/>Reference</span></a></li><li><ul><li><a href="#advertiseserviceopts"><span>advertise<wbr/>Service(opts)</span></a></li><li><a href="#discoverservicesopts"><span>discover<wbr/>Services(opts)</span></a></li><li><a href="#tobaseurlservice"><span>to<wbr/>Base<wbr/>Url(service)</span></a></li></ul></li><li><a href="#transport-support"><span>Transport <wbr/>Support</span></a></li><li><ul><li><a href="#http"><span>HTTP</span></a></li><li><a href="#websocket"><span>Web<wbr/>Socket</span></a></li></ul></li><li><a href="#service-selection"><span>Service <wbr/>Selection</span></a></li><li><ul><li><a href="#filter-by-transport"><span>Filter by <wbr/>Transport</span></a></li><li><a href="#select-by-version"><span>Select by <wbr/>Version</span></a></li><li><a href="#multiple-criteria"><span>Multiple <wbr/>Criteria</span></a></li></ul></li><li><a href="#authentication"><span>Authentication</span></a></li><li><ul><li><a href="#psk-pre-shared-key"><span>PSK (<wbr/>Pre-<wbr/>Shared <wbr/>Key)</span></a></li></ul></li><li><a href="#understanding-servicename-node-and-version"><span>Understanding service<wbr/>Name, node, and version</span></a></li><li><a href="#examples--tests"><span>Examples &amp; <wbr/>Tests</span></a></li><li><a href="#how-it-works"><span>How <wbr/>It <wbr/>Works</span></a></li><li><a href="#contributing"><span>Contributing</span></a></li><li><a href="#resources"><span>Resources</span></a></li><li><a href="#license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">@mcp-z/mcp-discovery</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
